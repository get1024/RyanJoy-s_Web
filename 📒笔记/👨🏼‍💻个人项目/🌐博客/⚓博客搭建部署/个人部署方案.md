---
title: Vitepress 个人部署方案
createAt: 2025-01-29 18:26:51
updateAt: 2025-01-30 10:06:42
---

# Vitepress 个人部署方案

## 切换域名

需要在 **Cloudflare、Vercel 和 腾讯云** 三个地方进行调整，以完成 **VitePress 站点域名从 `ryanjoy.top` 迁移到 `blog.ryanjoy.top`** 的操作。

### 在 Cloudflare 添加 `blog.ryanjoy.top` 解析

Cloudflare 负责 DNS 解析，因此我们需要在 **Cloudflare** 里添加新的 `CNAME` 记录：

1. **进入 Cloudflare 控制台**，选择 `ryanjoy.top` 域名。
2. **切换到 “DNS” 选项卡**。
3. **添加一条新的 `CNAME` 记录**：
    - **名称 (Name)**：`blog`
    - **目标 (Target)**：`cname.vercel-dns.com`
    - **代理状态 (Proxy status)**：⚠ **保持“DNS 仅” (灰色云朵) 状态，不要启用 Cloudflare 代理（橙色云朵）**，否则可能会导致 Vercel 无法正确处理。
4. **保存修改**。

### 在 Vercel 绑定 `blog.ryanjoy.top` 域名

现在我们需要告诉 **Vercel**，我们的 VitePress 站点应该使用 `blog.ryanjoy.top`

1. **进入 [Vercel 控制台](https://vercel.com/)**，打开我们的 VitePress 项目。
2. **进入 “Settings” → “Domains”** 页面。
3. **点击 “Add a Domain”**，输入 `blog.ryanjoy.top`，然后点击 “Add”。
4. **Vercel 可能会提示我们需要配置 DNS 解析**，但由于我们已经在 **Cloudflare** 添加了 `CNAME` 记录，理论上会自动检测成功。
5. **如果 Vercel 显示 "Invalid Configuration"**：
    - 我们可以点击 **"View Instructions"**，按照 Vercel 提供的 CNAME 解析方式检查是否正确。
    - 确保 Cloudflare 里 `blog.ryanjoy.top` 的 CNAME 解析 **未启用 Cloudflare 代理**（应该是 **“DNS only”**）。

### 访问 `blog.ryanjoy.top` 验证是否生效

- 在 **浏览器中访问 `blog.ryanjoy.top`**，查看是否能够正确加载 VitePress 站点。
- 我们也可以在 `powershell` 使用 ** `nslookup blog.ryanjoy.top` 或 `ping blog.ryanjoy.top` ** 检查解析是否生效。
- 一般 DNS 解析 **可能需要几分钟到 24 小时生效**，如果访问不成功可以稍等一会儿。

### 🎯 总结

1. **Cloudflare**：添加 `blog.ryanjoy.top` 的 CNAME，指向 `cname.vercel-dns.com`，并 **关闭 Cloudflare 代理**（使用“DNS 仅”）。
2. **Vercel**：在项目里添加 `blog.ryanjoy.top` 作为自定义域名。

这样，VitePress 站点就会成功迁移到 `blog.ryanjoy.top` 🎉。

::: details 为什么要关闭 Cloudflare 代理（使用 “DNS only”）？

Cloudflare 提供 **代理模式（橙色云朵）** 和 **DNS 解析模式（灰色云朵，DNS only）**，但在 **Vercel 部署的 VitePress 站点** 上，**必须使用“DNS only”**，原因如下：

**1. Vercel 需要直接管理 HTTPS 证书**

- **Vercel 自带自动 HTTPS 证书管理**，当你在 Vercel 添加 `blog.ryanjoy.top` 后，Vercel 会自动为该域名生成并绑定 **Let's Encrypt SSL 证书**。
- **如果启用 Cloudflare 代理（橙色云朵）**，Vercel 可能无法正确检测到域名的真实 IP，导致：
    - SSL 证书验证失败（Vercel 提示 `Invalid Configuration`）。
    - 站点可能会出现 **403、525 SSL handshake failed 等错误**。

**2. 避免 CNAME 解析问题**

- 在 Cloudflare **代理模式（橙色云朵）** 下，Cloudflare **会把 CNAME 解析转换为 A 记录**，这样：
    - Vercel 无法正确识别 `blog.ryanjoy.top` 绑定到它的 IP 地址，导致解析失败。
    - 可能会导致访问时出现 **“Not Found”** 或 **Vercel 识别错误的 IP**。

**3. Cloudflare 代理可能影响 Vercel 的动态功能**

- Vercel 提供了一些动态功能（如 Edge Functions、动态 API 路由），如果 Cloudflare 代理开启：
    - 可能会影响 Vercel 的**缓存策略**，导致数据不更新或加载异常。
    - Cloudflare 可能会拦截 Vercel 的 WebSocket 连接等功能。

**如何解决？**

1. **在 Cloudflare DNS 配置里，找到 `blog.ryanjoy.top` 这条 CNAME 记录。**
2. **确保代理状态为 “DNS only”**（**灰色云朵**）。
3. **等待 DNS 解析生效**（通常几分钟到 24 小时）。
4. **在 Vercel 重新检查 `blog.ryanjoy.top` 的绑定状态**。

**总结**

✅ **正确做法**：使用 **DNS only**（灰色云朵），让 Vercel 正确处理 SSL 证书和域名解析。  
❌ **错误做法**：启用 Cloudflare 代理（橙色云朵），会导致 **Vercel SSL 失败、CNAME 解析异常、动态功能受影响**。

只要你保持 **Cloudflare 的 CNAME 解析为 “DNS only”**，Vercel 就能正确绑定 `blog.ryanjoy.top`，让你的 VitePress 站点稳定运行 🚀！

:::